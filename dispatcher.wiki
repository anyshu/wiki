= dispatcher使用手册 =
dispatcher是公司开发的面向rtsp协议的负载均衡系统.

该系统主要有两个模块.在流化服务器上部署的agent节点,与独立部署的proxy节点.agent节点收集流化服务的信息,proxy节点进行具体的负载均衡操作.

dispatcher的功能:
* 提供负载均衡功能
* 提供多流化服务器的统一入口,内部通过重定向完成具体的流化任务分配.
* 提供多级dispatcher系统功能,可以将不存在视频重定向到高一级dispatcher的proxy节点,从而提供多级dispatcher功能.
* 提供点播成功日志与点播缺失日志.这样视频同步模块,可以根据这个信息,进行选择性的同步视频,删除不活跃视频资源.

负载均衡功能:
目前主要采用的两层次最小流量负载均衡方法.

agent节点,可以配置自己的流化服务网路吞吐能力阈值,如100Mbps.agent节点搜集自己的网络吞吐状态,并且向proxy节点汇报自己的网络占用比例.

proxy节点,设定流化服务的网络吞吐能力统一阈值,如90%.超过统一阈值,则不会将流化任务重定向到它.

proxy节点,选择流量占用比例最低的节点,将流化服务重定向到它.

== agent节点使用 ==
=== 运行 ===
运行通过在agent程序所在路径下运行`./agent /PATH/TO/agent.conf`.

=== 配置 ===
具体的配置内容,可以参考agent.conf,这里仅仅列出常用的配置内容.
# proxy_ip                   配置proxy节点的IP地址
# data_path_num,data_path_0  配置监控视频文件的路径,这里一般设置为/data,该路径必须保证存在
# check_app_name             检查运行状态的流媒体程序名称,一般设为StreamingServer,如果在测试过程,运行了tool/fakeServer,则这里填写为python
# app_startup_time          设定的流媒体服务的启动时间,这里可以设为2(s),建议不要小于这个值.
# bo_thres                  设定的网络吞吐阈值,单位为Mbps.

== proxy节点使用 ==
=== 运行 ===
运行通过在proxy程序所在路径下运行`./proxy /PATH/TO/proxy.conf`.

== 配置 ==
同样,仅仅列出常用配置.

# rtsp_port 5000,默认值为554,但是为了避免了流化服务器冲突,这里一致设定为5000.因为和其他模块配合问题,这里不要改用其他端口
# bo_thres  设定的统一网路吞吐阈值,单位为%,默认为90%.
# default_host  设定的默认转发地址,注意,如果不需要默认转发地址(例如中心节点的proxy,含有全部文件的dispatcher系统,就不需要), *这里务必注释该行,或者配置为空.* 

这里的default_host, *不可以配置为proxy自己的本机地址* ,这样就会造成环路,不断进行redirect,直到资源耗尽.
