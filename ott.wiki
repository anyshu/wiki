= ott =

== 部署方案 ==
mtime: 2013-07-12 10:05:16 

影片以省中心为数据中心,存储全部影片数据.以地市为节点,缓存部分影片数据.节点缓存空间大小为中心空间的 a 倍(建议 0.3 < a < 0.5).

更新方式:
- 地区主动请求.
    # 当地区级别机顶盒向地区节点发起点播请求,这时候地区节点不存在相应的影片内容.
    # 地区节点流化任务分发模块,将流化任务重定向到中心.由中心直接向地区机顶盒进行服务.
    # 同时,地区流化任务分发模块通知地区影片同步模块,有一次地区影片缺失记录.
    # 地区影片同步模块,发起同步请求到中心.从中心拉取影片到地区节点.(可能需要同时考虑删除其他影片,以给出存储空间)
    # 地区流化任务分发模块,检测到影片变动(影片的删除和添加),这时候对于新的同一影片点播,将通过地区节点直接进行服务.

- 中心主动下发分发任务
    # 对于最近热门的影片,以及播放列表最近更新到前位的影片,需要中心提前主动下发分发任务,从而保证服务质量.
    # 中心下发更新任务到地区同步模块
    # 地区同步模块,主动从中心拉取相应的影片.
    # 地区流化任务分发模块,检测到影片变动.

== 地区节点的更新策略 ==

对于两种请求,地区节点需要进行不同的策略.
- 对于地区主动请求任务.
    - 当地区机顶盒点播到地区分发模块时候,发现一次未命中的情况.汇报一次地区节点同步请求到地区节点模块.
    - 地区同步模块,统计未命中的情况.地区同步模块,同时统计影片的点播情况.
    - 对于未命中超过一定阈值,地区同步节点从中心拉取影片到地区节点.

- 对于中心主动下发任务
    - 地区节点立刻从中心拉取硬盘到地区节点.

地区节点根据过去一个月的影片活跃程度来进行统计.

当发生同步任务时候,清除影片活跃程度最低的影片(如果活跃程度相同,则随机删除一个影片)

== 对应的开发任务 ==

以下模块需要进行开发:
# 地区同步模块
    - 接收外部的同步任务,从中心拉取影片.
    - 当地区存储空间已满,决定影片的删除.
# 中心更新任务模块
    - 下发更新任务到地区同步模块
    - 供未来的内容管理系统调用.(内容管理同时负责下发同步任务,以及更新web播放列表)

以下模块需要修改:
# 地区任务分发模块
    - 当检测到本地不存在的影片,时需要重定向到中心.
    - 当检测到本地不存在的影片的时候,需要将影片缺失信息告诉地区同步模块.
    - 点击次数的统计(用于同步模块判断活跃程度,以及后续的推荐系统使用)
    - 统计格式可以如下:
        - [时间] XXX影片名称  命中    命中到的本地流化服务器地址
        - [时间] XXX硬盘名称  未命中  命中到中心任务分发模块地址
    - 需要检测文件同步结束,才进行本地点播的任务分发.

-----


按照影片的活跃程度来区分.

影片的活跃程度根据过去一个时间段(以月为单位),进行统计.总的点击次数作为活跃程度的估计.按照点击次数排序,得到最为活跃的影片.

分为两类:
# 影片活跃持续时间长度超过T1.这部分内容占据节点总存储量的b倍.
# 影片活跃持续时间程度不超过T1.这部分占据节点总存储了的(1-b)倍.

建议 0.5 < b < 0.7.

